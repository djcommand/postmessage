
<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/2.1.0/es5-shim.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css">
    <style>
  .modal {
    border-radius: 0;
    height: 70%;
    width: 600px;
  }
  .modal-body {
    position: relative;
    overflow: visible;
    height:100%;
    padding: 0;
    max-height: none;
  }
  .signInIframe {
    height:100%;
    width:100%;
    position:absolute;
    top:0px;
    left:0px;
    right:0px;
    bottom:0px;
    margin: 0 auto;
    display:inline;
  }

  .modal.fade.in{
    top:15%;
  }

  .btn {
    z-index: -1;
  }
  button.close {
    z-index: 999;
    position: absolute;
    top: 10px;
    right: 20px;
    color: #fff;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";
    filter: alpha(opacity=100);
    opacity: 1;
    font-weight: 100;
    font-size: 28px;
  }
  .close:hover,
  .close:focus {
    color: #fff;
    text-decoration: none;
    cursor: pointer;
    opacity: 0.8;
    filter: alpha(opacity=80);
  }
  .launch {
    position: absolute;
    left: 0px;
  }
  .glamour {
    z-index: -1;
  }
  .ios-scroll {
    -ms-overflow-y: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  @media all and (min-width: 320px) and (max-width: 640px) {
    .modal-body {
      width: 100%;
      height: 100%;
    }
    button.close {
      z-index: 999;
    }
  }

  @media (max-width: 767px) {
  .modal.fade.in {
    top: 0;
    left:0;
    right:0;
  }

  .modal {
    width: auto;
    height: 100%;
  }
  }

  /* Spinner styles */
  .loader {
    position: absolute;
    top:45%;
    left:50%;
    margin-left: -8px;
    margin-top: -8px;
    background-color: #000;
    width: 50px;
    height: 50px;
    border-radius: 10px;
    opacity: .8;
    z-index: 1101;
  }
  .loader img {
    position: absolute;
    top:16%;
    left:16%;
  }
  .overlay-bg {
    position: absolute;
      top:50px;
      left:0;
      width:100%;
      height:100%;
      z-index:1100;
      background: rgba(0,0,0,.62);
      background: transparent -webkit-gradient(radial, center center, 10, center center, 600, from(rgba(0,0,0,.01)), to(rgba(0,0,0,.7)));
  }
  </style>

  </head>
  <body  ng-app="yoAngularApp">
    <div class="container">
      <a id="signIn" href="#myModal" role="button" class="btn launch" data-toggle="modal">Sign In/Register</a>
      <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="frameContainer" class="modal-body ios-scroll">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
            <!--[if IE 8]><iframe id="cnidClient" src="" class="signInIframe" frameborder="0" marginheight="0" marginwidth="0" height="620" width="600"></iframe> <![endif]-->
    <!--[if (gt IE 8)|!(IE)]><!--> <iframe id="cnidClient" src="" class="signInIframe" frameborder="0" marginheight="0" marginwidth="0" height="100%" width="100%"></iframe><!--<![endif]-->
          <!-- Overlay -->
          <div id="loader-container" class="hide">
            <div class="overlay-bg"></div>
            <div class="loader">
              <img src="https://stag-cnid.condenastdigital.com/client/assets/img/spinner.gif">
            </div>
          </div>
        </div>
      </div>
      <!--[if IE 8]>
        <style>
           .modal-body{
            overflow-y:visible
           }
        </style>
      <![endif]-->
    </div>
    <div id="message"></div>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script>
    var CNID = (function(){
      var hashVal = document.location.hash.split('#')[1],
          cnidDev = 'http://ci-cnid.conde.io',
          cnidStag = 'https://stag-cnid.condenastdigital.com',
          cnidProd = 'https://cnid.condenastdigital.com';
      return {
        init: function(obj){
          //  set iframe src
          var iframeSrc = cnidEnv = appName = envPrefix = '';
          appName = obj.brand;
          hashVal = hashVal || 'prod';  //  default to prod, when no hash exits
          switch(hashVal) {
            case 'dev':
              cnidEnv = cnidDev;
              break;
            case 'stag':
              cnidEnv = cnidStag;
              break;
            case 'prod':
              cnidEnv = cnidProd;
              break;
            default:
              cnidEnv = 'http://' + hashVal;
          }
          console.log('cnidEnv: ' + cnidEnv);
          if(hashVal.indexOf('ist-')!=-1) {
            //  LOCAL
            iframeSrc = cnidEnv + ':9001?domain=' + cnidEnv + ':5000/#/' + appName + '/login';
          } else {
              if(!hashVal) {
                //  default to whatever targetOrigin
                envPrefix = '';
              } else {
                //  for DEV, STAG
                envPrefix = hashVal + '-';
              }
              //  DEV
              iframeSrc = cnidEnv + '/client/index.html?domain=http://' + envPrefix + obj.targetOrigin + '/#/' + appName + '/login';
          }
          console.log('iframeSrc: ' + iframeSrc);
          $('#' + obj.iframeId).attr('src', iframeSrc);
          //  setup posmesaging
          this.setupPostmessaging(obj);
        },
        setupPostmessaging: function(obj){
          // create a compatible event handler
          var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent",
              eventer = window[eventMethod],
              messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
          //  postmessage listener
          eventer(messageEvent,function(e) {
            try {
              //  console.dir(JSON.parse(e.data));
              obj.postMessageCallback(JSON.parse(e.data));
            } catch(e){
              //  console.log(e.message);
            }
          },false);
        }
      }
    })();
    //  Initialize the CNID client
    CNID.init({
      iframeId: 'cnidClient',
      brand: 'com.condenet.glamour',
      regPath: 'auth',
      regSrc: 'CNEE_GLM',
      targetOrigin: 'cnee.condenastdigital.com/admin/postmessage.html',  //  origin receiving the postmessage
      postMessageCallback: function(data){
        //  called every time cnid tries to communicate to brand client
        if (data.scrollTop) {
          //  scroll to top
          $("#frameContainer").animate({
            scrollTop: 0 // scroll to top
          }, 1);
        }
        if (data.showLoader) {
          //  show loader
          $('#loader-container').show();
        } else {
          $('#loader-container').hide();
        }
        if (data.authToken) {
          //  use token to get cookie information from the CNID server
          //  log user in
          $('#myModal').modal('hide');
          $('#signIn').text('Logout');
        }
      }
    });
    </script>
  </body>
</html>